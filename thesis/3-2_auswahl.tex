\subsection{Anforderungsanalyse}
\label{sec:anforderungsanalyse}
An die auszuwählenden Frameworks oder Tools beziehungsweise eine Kombination Mehrerer stellen sich die folgenden Anforderungen:
\begin{enumerate}[label=\textbf{A\arabic*}]
	\item Es muss die Durchführung von Komponententests möglich sein.
	\item Es muss die Durchführung von End-To-End-Tests möglich sein.
	\item Es muss der Test von AngularJS-Anwendungen möglich sein.
	\item Es muss die Testausführung von Komponententests im Browser aus der Konsole heraus möglich sein.
	\item Sie muss Open-Source und für den kommerziellen Einsatz freigegeben sein.
	\item Sie soll durch eine Open-Source-Community aktiv gewartet werden; Fehler in ihr sollen behoben werden.
	%\item Es muss mindestens der aktuelle Commerzbank-Standard, ECMA-262 5.1, unterstützt werden\cite[][10]{coba-programmierrichtlinienJavaScript}.
	\item Der Testcode soll leicht lesbar sein\cite[][7]{coba-programmierrichtlinienAllgemein}; hierzu bietet sich der BDD-Stil an, den das Testframework somit unterstützen soll.
	\item Die Software soll eine geringe Einarbeitungszeit erfordern und problemlos zu verwenden sein. 
	\item Sie soll dem Entwickler Flexibilität beim Schreibe der Testfallimplementationen und Assertions bieten, damit dieser möglichst nah an seinen persönlichen Präferenzen arbeiten kann.
	\item Die Ausgabe der Testergebnisse muss konfigurierbar sein, um sie gegebenenfalls in Prozessen oder anderen Tools weiterverwenden zu können.
	\item Bei der Durchführung von End-To-End-Tests soll es möglich sein, die Ergebnisse mit Screenshots zu dokumentieren.
	\item Der Einsatz von Spies, Stubs und Mocks muss bei Unit-Tests möglich sein.
\end{enumerate}

\newpage
Aufgrund diverser regulatorischer Vorgaben, Prozesse und vorhandener technischer Systeme innerhalb des Commerzbank-Konzerns ergeben sich weitere Anforderungen:
\begin{enumerate}[label=\textbf{CB\arabic*}]
	\item Die Software muss unter Windows 7 funktionieren.
	\item Es darf keine zusätzliche Software zur Ausführung erforderlich sein; lediglich Node.js und Java sind zulässig, da diese über die Standardsoftwareverteilung der Commerzbank verfügbar sind.
	\item Wenn die Software Node.js benötigt, muss sie mit Version 6.9.2 lauffähig sein.
	\item Die Software muss über den Node Package Manager installierbar sein.
	\item Gemäß dem SEF der Commerzbank müssen Testfälle eindeutig beschrieben werden; diese Beschreibung auch kann durch Implementierung der Tests erfolgen\cite{coba-sef}. Das Testframework soll daher eine Beschreibung der Tests forcieren.
	\item Gemäß dem SEF sollen Komponententests \glqq einen möglichst großen Teil der Funktionalität abdecken\grqq{}\cite{coba-sef}. Zur Überprüfung dessen muss eine Möglichkeit zur Ermittlung der Code Coverage bestehen.
	\item Das Bearbeiten aller Dateien in der TFS-Quellcodeverwaltung soll möglich sein, es dürfen somit keine proprietären Binärdateien zum Einsatz kommen.
\end{enumerate}

Zur Erfüllung der Anforderung A1 werden ein \textit{Testrunner}, ein \textit{Testframework} zum Anlegen und Beschreiben der Testfälle sowie eine \textit{Assertion-Bibliothek} benötigt. Zur Erfüllung von Anforderung A2 wird zusätzlich ein \textit{Tool zur Browsersteuerung} benötigt.

\newpage
\input{3_software}

\newpage
\subsection{Auswahlentscheidung}
\label{sec:auswahlentscheidung}
Für die Entscheidungsfindung wird eine Entscheidungsmatrix (s. Tabelle \\ref{tbl:entscheidungsmatrix}) erstellt, in welcher die gefundene Software mit Blick auf die Anforderungen bewertet wird. Ein rotes Kreuz bedeutet, dass die Software der Anforderung widerspricht und die Erfüllung der Anforderung unmöglich macht. Ein grüner Haken steht für ein Erfüllen der Anforderung. Eine leere Zelle bedeutet, dass die Software die Anforderung weder explizit erfüllt noch ihr widerspricht; es besteht keine Relevanz. Die ausgewählte Softwaremenge erfüllt eine Anforderung somit nur dann, wenn lediglich grüne Haken oder leere Zellen vorhanden sind, also keine Einzelsoftware der Anforderung widerspricht.

Wie in Abschnitt \ref{sec:anforderungsanalyse} bereits beschrieben werden zur Erfüllung von Anforderung A1 ein Testrunner, ein Testframework sowie eine Assertion-Bibliothek benötigt; zur Erfüllung von Anforderung A2 zusätzlich ein Tool zur Browsersteuerung. Hierzu werden die gefundenen Programme kategorisiert. Die endgültig ausgewählte Softwaremenge muss mindestens ein Exemplar jeder Kategorie enthalten, damit die Anforderungen A1 und A2 erfüllt werden.

%\begin{table}[H] \centering
	%\begin{tabular}{@{} cl*{11}c @{}}
	%	& & \rot{Karma} & \rot{Mocha} & \rot{AVA} & \rot{QUnit} & \rot{Intern} & \rot{Jasmine} & \rot{Chai} & \rot{Protractor} & \rot{PhantomJS} & \rot{CasperJS} & \rot{Sinon} & \rot{ngMock} \\\hline
	%	& \textit{1a} - Komponententest & \OK & \OK & \OK & \OK & \OK & \OK & & & & & &  \\
	%	
	%\end{tabular}
	\begin{tabularx}{\textwidth}{@{}r@{\hskip 6pt}X|ccccccccccccc}
		&& \multicolumn{12}{c}{Software} \\ &&  \rot{\footnotesize{Karma}} & \rot{\footnotesize{Mocha}} & \rot{\footnotesize{AVA}} & \rot{\footnotesize{QUnit}} & \rot{\footnotesize{Intern}} & \rot{\footnotesize{Jasmine}} & \rot{\footnotesize{Chai}} & \rot{\footnotesize{Protractor}} & \rot{\footnotesize{PhantomJS}} & \rot{\footnotesize{CasperJS}} & \rot{\footnotesize{Sinon}} & \rot{\footnotesize{ngMock}} & \rot{\footnotesize{Istanbul}} \\ \hline
		%									Ka		Mo		Av		QU		In		Ja		Ch		Pr		Ph		Ca		Si		ng		Is
	    \multirow{5}{*}{\centering\rot{\footnotesize{Kategorie}}}
		&	\footnotesize{Testrunner}	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& 		& 		&		& \ok	&		&  		&\\
	    &	\footnotesize{Testframework}
							    		&		& \ok	& \ok	& \ok	& \ok	& \ok	&		&		&		& \ok	&		& 		&\\
	    &	\footnotesize{End-To-End}	
									    & 		&		&		&		& \ok	&		&		& \ok	& \ok	& \ok	&		&  		&\\
	    &	\footnotesize{Assertion}	& 		&		& \ok	& \ok	& \ok	& \ok	& \ok	& 		& 		& \ok	& 		&  		&\\
	    &	\footnotesize{Sonstige}		&		&		&		&		&		&		&		&		&		&		& \ok	& \ok	& \ok \\\hline\hline
	    
	    \footnotesize{A3}
	     &	\footnotesize{AngularJS-Support}	
									    & \ok	& \ok	& \nok\footnote{\url{https://github.com/angular/angular.js/issues/13971}}
																& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok
																													    & \ok	& \ok	& \ok \\
		\footnotesize{A4}
		 & \footnotesize{Testausführung}& \ok	& 		& 	  	& 		& 		& \ok	& 		&		&		& \nok	&		&		& \\
		
		\footnotesize{A5}
		 & \footnotesize{Open Source \& kommerziell}
										& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok \\
		\footnotesize{A6}
		 & \footnotesize{Wartung\footnote{Zur Auswertung dieser Anforderung wird das jeweilige Github-Repository herangezogen.}}
										& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \nok\footnote{1.841 offene Issues; 2 Issues geschlossen in der letzten Woche \cite{phantomjs-issues,phantomjs-pulse}}
																												& \ok	& \ok	& \ok	& \ok \\ 
		%11 & \textbf{ECMA-262 5.1}		& 		& \ok	&		&		&		&		& \ok	&		&		&		&		& \\

		\footnotesize{A7}
			 & \footnotesize{BDD-Stil}	&		& \ok	& \nok	& \nok	& \ok	& \ok	& \ok	&		&		& \nok	&		& 		&\\
		\footnotesize{A8} 
		& \footnotesize{Einarbeitung \& Verwendung}
										& \ok	& \ok	& \ok	& \ok	& \nok\footnote{Warten auf asynchrone AngularJS-Komponenten muss bei End-To-End-Tests manuell implementiert werden.}
																				& \ok	& \ok	& \ok	& \ok	& \nok\footnote{Warten auf asynchrone AngularJS-Komponenten muss manuell implementiert werden.}
																														& \ok	& \ok	& \ok \\
		\footnotesize{A9}
		 & \footnotesize{Flexibilität}& 		& \ok	& \nok	& \nok	& \ok	& \nok	& 		&		&		& \nok	&		& 		& \\
		\footnotesize{A10}
		 & \footnotesize{Ausgabe-Konfiguration}
										& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	&		&		& 		& \nok	&		& 		& \ok \\
		\footnotesize{A11}
		 & \footnotesize{Screenshots}	&		&		&		&		& \nok	&		&		& \ok	& \ok	& \ok	&		& 		&\\
		\footnotesize{A12}
		 & \footnotesize{Spies, Stubs, Mocks}
										&		&		&		&		&		&		&		&		&		& 		& \ok	& \ok	& \\
		\footnotesize{CB1}
		&	\footnotesize{Windows 7}			& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok 	& \ok \\
		\footnotesize{CB2}
		& \footnotesize{benötigte Software}	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok 	& \ok\footnote{Zur Ausführung wird zwar Selenium benötigt, dies wird aber automatisiert mitinstalliert. Die Software erfüllt die Anforderung daher.}
		& \ok	& \nok	& \ok	& \ok 	& \ok \\
		\footnotesize{CB3}
		& \footnotesize{Node.js 9.6.2}& \ok	& \ok	& \ok 	& \ok	& \ok	& \ok	& \ok	& \ok	&  \ok	& \ok	& \ok	& \ok	& \ok \\
		
		\footnotesize{CB4}
		& \footnotesize{npm}			& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \nok	& \ok	& \ok	& \ok	& \ok \\		
		\footnotesize{CB5}
		& \footnotesize{Forcierte Beschreibung}
		&		& \ok	& \nok	& \ok	& \ok	& \ok	& 		& 		&		& \ok	& 		&		& \\		
				\footnotesize{CB6}
				& \footnotesize{Code-Coverage}		
				& 		& 		& 		& 		& \ok	&		&		&		&		&		&		& 		& \ok\\ 
				\footnotesize{CB7}
				& \footnotesize{keine proprietären Dateien}
				& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	& \ok	 
					
	\end{tabularx}
	\captionof{table}{Entscheidungsmatrix zur Softwareauswahl\label{tbl:entscheidungsmatrix}}
	
	Die Auswertung der Entscheidungsmatrix zeigt, dass AVA, QUnit, Intern, Jasmine, PhantomJS sowie CasperJS nicht eingesetzt werden können, da sie Anforderungen widersprechen. Die Verbleibenden bilden die Basis für die zu treffende Auswahl aufgrund der Anforderungen. Es zeigt sich, dass nur durch den Einsatz sämtlicher verbleibender Software sämtliche Anforderungen abgedeckt werden können. Es wird somit folgende Auswahl getroffen:
	
	Als Test-Runner wird Karma eingesetzt, welches die benötigten JavaScript-Dateien importiert, bereitstellt und aus der Konsole heraus die in Mocha implementierten Tests ausführt. Die sich aus der Matrix ergebende Kombination von Mocha mit der Assertionbibliothek Chai wird von \textcite{mocha-index} bereits in der Softwaredokumentation aufgeführt, wodurch hier von einem problemlosen Zusammenarbeiten auszugehen ist. Für die Ermittlung der Code-Coverage wird Istanbul eingesetzt; die Kombination des Einsatzes mit Mocha wird in  \cite{istanbul} explizit empfohlen, so dass auch hier von keinerlei Problemen auszugehen ist.
	
	Für die Realisierung von End-To-End-Tests wird auf das vom AngularJS-Team entwickelte Protractor zurückgegriffen und somit auch der Empfehlung aus der offiziellen AngularJS-Dokumentation  \cite{angular-e2e} gefolgt. Die abweichende Kombination von Protractor mit Mocha und Chai, statt Jasmine, wird von vielen Entwicklern genutzt und unter Anderem in  \cite{protractormocha-1} und  \cite{protractormocha-2} beschrieben, so dass auch hier von keinen Problemen auszugehen ist.
	
	Für die Realisierung von Spies, Stubs und Mocks in Komponententests wird auf Sinon und ngMock gesetzt.
%\end{table}